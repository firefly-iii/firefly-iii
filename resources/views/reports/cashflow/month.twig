{% extends './layout/default' %}

{% block breadcrumbs %}
    {{ Breadcrumbs.render(Route.getCurrentRoute.getName, accountIds, start, end) }}
{% endblock %}

{% block content %}

    {# Cash Flow Summary #}
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title"><i class="fa fa-exchange"></i> Cash Flow Analysis</h3>
                    <div class="box-tools pull-right">
                        <span class="label label-info">{{ start.format('M Y') }} - {{ end.format('M Y') }}</span>
                    </div>
                </div>
                <div class="box-body">
                    <p class="lead">This report analyzes your income vs. expenses over the selected period, helping you understand your cash flow patterns and identify trends.</p>
                    <canvas id="cashflow-chart" style="width:100%;height:300px;" height="300" width="100%"></canvas>
                </div>
            </div>
        </div>
    </div>

    {# Income vs Expenses Comparison #}
    <div class="row">
        <div class="col-lg-4 col-md-4 col-sm-12">
            <div class="box box-success">
                <div class="box-header with-border">
                    <h3 class="box-title"><i class="fa fa-arrow-down"></i> Total Income</h3>
                </div>
                <div class="box-body table-responsive no-padding" id="incomeReport">
                    {# This will be loaded via AJAX or populated with data #}
                    <div class="overlay">
                        <span class="fa fa-refresh fa-spin"></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-4 col-sm-12">
            <div class="box box-danger">
                <div class="box-header with-border">
                    <h3 class="box-title"><i class="fa fa-arrow-up"></i> Total Expenses</h3>
                </div>
                <div class="box-body table-responsive no-padding" id="expenseReport">
                    {# This will be loaded via AJAX or populated with data #}
                    <div class="overlay">
                        <span class="fa fa-refresh fa-spin"></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-4 col-sm-12">
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title"><i class="fa fa-calculator"></i> Net Cash Flow</h3>
                </div>
                <div class="box-body table-responsive no-padding" id="netCashFlowReport">
                    {# This will be loaded via AJAX or populated with data #}
                    <div class="overlay">
                        <span class="fa fa-refresh fa-spin"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {# Cash Flow by Category #}
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title"><i class="fa fa-tags"></i> Cash Flow by Category</h3>
                </div>
                <div class="box-body table-responsive no-padding" id="categoryReport">
                    {# This will be loaded via AJAX or populated with data #}
                    <div class="overlay">
                        <span class="fa fa-refresh fa-spin"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {# Budget Performance #}
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title"><i class="fa fa-pie-chart"></i> Budget Performance</h3>
                </div>
                <div class="box-body table-responsive no-padding" id="budgetReport">
                    {# This will be loaded via AJAX or populated with data #}
                    <div class="overlay">
                        <span class="fa fa-refresh fa-spin"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {# Daily Cash Flow Trend #}
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title"><i class="fa fa-line-chart"></i> Daily Cash Flow Trend</h3>
                </div>
                <div class="box-body">
                    <canvas id="daily-cashflow-chart" style="width:100%;height:250px;" height="250" width="100%"></canvas>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="v1/css/bootstrap-sortable.css?v={{ FF_BUILD_TIME }}" type="text/css" media="all" nonce="{{ JS_NONCE }}">
{% endblock %}

{% block scripts %}
    <script type="text/javascript" src="v1/js/lib/bootstrap-sortable.js?v={{ FF_BUILD_TIME }}" nonce="{{ JS_NONCE }}"></script>
    <script type="text/javascript" src="v1/js/lib/Chart.bundle.min.js?v={{ FF_BUILD_TIME }}" nonce="{{ JS_NONCE }}"></script>
    <script type="text/javascript" src="v1/js/ff/charts.defaults.js?v={{ FF_BUILD_TIME }}" nonce="{{ JS_NONCE }}"></script>
    <script type="text/javascript" nonce="{{ JS_NONCE }}">
        var startDate = '{{ start.format('Ymd') }}';
        var endDate = '{{ end.format('Ymd') }}';
        var reportType = '{{ reportType }}';
        var accountIds = '{{ accountIds }}';

        // Initialize charts with placeholder data
        var ctx = document.getElementById('cashflow-chart');
        if (ctx) {
            var cashflowChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Income', 'Expenses', 'Net Cash Flow'],
                    datasets: [{
                        label: 'Cash Flow',
                        data: [0, 0, 0],
                        backgroundColor: ['#00a65a', '#dd4b39', '#3c8dbc']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        console.log('Cash Flow Report loaded for period:', startDate, 'to', endDate);
        console.log('Accounts:', accountIds);
    </script>
{% endblock %}

